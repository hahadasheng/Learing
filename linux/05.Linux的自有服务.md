# Linux的自有服务

## 一、运行级别

> 在linux中存在一个进程；init(initialize 初始化)，进程id为1
查看进程：`ps -ef|grep init`

该进程的配置文件：`/etc/inittab`(系统运行级别配置文件)
```
id:5:initdefault;
```

1. **`init 0`**: 关机【不能设置为默认启动级别】
2. `init 1`: 单用户模式，只能同时只能一个用户登录
3. `init 2`: 多用户模式，不带NFS(Network File System)
4. **`init 3`**: 多用户模式，完全的多用户模式
5. `init 4`: 没有被使用的模式(保留模式)
6. `init 5`: X11, 完成的图形化界面模式
7. **`init 6`**: 表示重启级别【不能设置为默认启动级别】

> 这些命令其实都是调用的init进程，将数字(运行级别)传递给进程，进程去读取配置文件进行对应的操作。

例如，切换到init 3： `init 3`

#### 设置模式永久为命令行模式

1. CentOS6 版本
`/etc/inittab`
```
id:3:initdefault:
```

2. CentOS7 版本，只能在命令行配置，在vim中配置似乎有问题
```
# 查看当前默认模式
systemctl get-default

# 设置默认模式为3，及命令行模式
systemctl set-default multi-user.target

# 重启服务器生效
reboot
```


## 二、用户的管理

**所有跟用户操作的命令，除了passwd外，只有root用户才有使用的权限**
> 用户账号的添加、删除、修改以及用户密码的管理;用户组的管理

#### 三个重要文件
1. `/etc/passwd` :存储用户的关键信息
> 格式：`用户名:密码占位:uid:用户主组id:用户注释:家目录:解释器shell`；解释器shell的功能是等待用户进入系统之后用户输入指令之后，该解释器会手机用户输入的指令，传递给内核
```
root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
```

2. `/etc/group` :存储用户组的关键信息

3. `/etc/shadow` :存储用户的密码信息


### 1.用户管理
1. 添加用户
    - 常见语法：`useradd 选项 用户名`
        - 常用选项
            - -g: 表示指定用户的用户组，选项值可以是用户组的id,也可以是组名
            - -G: 表示指定用户的附加组，选项的值尅是用户的id,也可以是组名
            - -u: uid,用户的id（用户的表示符），系统默认会从500之后按照顺序分配uid
            - -c: 添加用户注释
    - 案例1：`useradd  zhangsan`
        - 验证：`/etc/passwd` 或者 `/etc/shadow` 的最后一行
        - 同时创建同名的家目录；同名的用户组
    - 案例2：`useradd -g 501 -G 500-u 666 lisi`
        - 查看用户的主组可以查看passwd文件，查看附加组可以查看group文件


2. 修改用户
    - 常见语法: `usermod 选项 用户名`
        - 常用选项
            - -g: 表示指定用户的用户组，选项值可以是用户组的id,也可以是组名
            - -G: 表示指定用户的附加组，选项的值尅是用户的id,也可以是组名
            - -u: uid,用户的id（用户的表示符），系统默认会从500之后按照顺序分配uid
            - -l: 修改用户名
    - 案例1：`usermod -g 500 -G 501 zhangsan`
    - 案例2：`usermod -l newwangma zhangsan`

3. 设置密码【Linux不允许没有密码的用户登录到系统，没有设置密码的用户处于锁定状态】
    - 常见语法：`passwd 用户名` --> 回车 --> 输入密码

4. 删除用户【root用户的权限】
    - 常见语法：`userdel 选项 用户名`
    - 常用选项：
        - -r: 删除用户的同时，删除其家目录
    - 案例：`userdel -r zhangsan`
    - 无法删除已经登录的用户
        - 解决办法：kill对应用户对应的进程pid
            - ps -ef|grep wanger
            - kill 对应的pid

5. 用户切换
    - `su [用户名]` ：默认root
    - 从root往普通用户切换不需要密码，但是反之需要root密码
    - 切换用户之后的工作路径是不变的；
    - 普通用户没有办法访问root用户家目录，但是反之则可以；

## 用户组的管理

> 每个用户都有一个用户组，系统可以对一个用户组中的所有用户几种管理。不同Linux系统对用户组的规定有所不同，如linux吓死的用户组属于与它同名的用户组，这个用户组在创建用户时同时创建。

> 用户组的管理设计用户组的添加、删除和修改。组的添加、删除和修改实际上就是对/etc/group文件的更新。

`cat /etc/group` 含义`用户组名:密码(站占位符):用户组ID:组内用户名(表示附加组是该组的用户名称)`
```
qemu:x:107:
ntp:x:38:
radvd:x:75:
chrony:x:990:
tss:x:59:
```

1. 用户组添加
    - 常用语法: `groupadd 选项 用户组名`
    - 常用选项：
        - -g: 自定义用户组id,不指定，默认从500后递增

2. 用户组编辑
    - 常用语法：`groupmod 选项 用户组名`
    - 常用选项：
        - -g: (同上)
        - -n: 设置新的用户组的名称
    案例：`groupmod -g 520 -n newadmin admin`

3. 用户组删除
    - 常用语法：`groupdel 用户组名`
    - 当需要删除一个组，但是这个组是某个用户的主组时，不允许删除。
        - 需要把组内的用户移除完，然后再删除。
            - 例如：`usermod -g 0 linux123` 然后再 `groupdel linux123`
