# MySql查询优化

## 一、索引

> **索引的算法思想举例**：设原始列表为List, 索引表(广义:列表、堆、B树...)Index,Index中存储List的所有索引index，根据索引index可以找到Index中的原始数据，可以根据原始数据的排序规则决定Index中存储的索引index的顺序位置；根据这种思想，原始列表List中数据可以用排序，当List中的数据发生了增、删、改操作时，维护一下索引表Index排序即可！当然，可以根据业务需求对于同一个原始列表，创建多个不同规则的索引列表。
；*MySQL的索引实现远比上面举例的要复杂，这里只是简单介绍基本思想！*

*索引实现示例：* [索引堆](@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@)

### 1.MySQL不同引擎的索引特点

> 不同的MySQL存储引擎，索引的实现细节有所不同。MySQL中的索引存储的不仅仅是原始数据的索引，还存储了原始映射值列(索引列)的数据等等；因为查询原始数据行是一件非常耗时的事，这样牺牲空间加快时间的做法就很合理了。

1. MyISAM表，数据行保留在数据文件里面，索引值保留在索引文件中。一张表可以有多个索引，它们是保存在同一个索引文件中。每一个索引就对应着一个有序的关键字序列

2. InnoDB储存引擎将原始数据列和索引都放在同一个表空间中;当然，索引数据和原始数据是分开的。

### 2.MySQL使用索引的优点

1. 加快对where字句匹配的行的搜索速度；加快与另一个连接表中行匹配的搜索速度

2. 优化min()或者max()函数的查询，避免全表检索，实现快速查找。

3. 对于`order by` 和 `group by`字句，使用索引高效的完成分类/分组操作。

4. 根据索引读取查询请求的信息，而且只查询建立索引映射的原始数据，这种情况下查询索引而不用定位到原始数据行就能获得数据，提高了查询效率。

### 3.MySQL索引的代价

> 算法与数据结构的世界，有的必有失；想达到十全十美，几乎是不肯能的事情；索引的优点是显而易见的，在实际应用中，几乎可以忽略缺点；但是假如索引使用的不当，平均性能会显著下降

1. 索引加快了检索的速度，但是同时降低了索引列的插入、删除和更新值的速度。因为要维护索引，索引越多，维护的就越多！性能就越糟糕！
2. 索引占用磁盘空间，容易达到表的大小极限。
    - MyISAM表，大量使用索引可能会导致索引文件比数据文件更快达到最大大小。
    - InnoDB系统表，InnoDB的表空间不受系统大小限制，一张表空间可以配置多个文件用于扩展空间，当然，索引越多，导致越容易达到每个文件的大小限制大小。

### 4.挑战索引

1. 为用于搜索、排序、分组的列创建索引：where、order by、group by后面的列。
2. 考虑数据列的基数，就是锁容纳的所有非重复值的个数，相对越大，越好。
3. 索引短小值，考虑较小的数据类型；比如InnoDB是使用的聚簇索引，索引值越短小性能越好。
4. 索引字符串的前缀。
5. 利用左前缀。
6. 不要建立过多的索引
7. 让参与比较的索引保持匹配。【InnoDB总会使用B树，MyISAM也会使用B树，单对于空间类型会改用R树】
8. 利用慢查询日志找出那些性能低劣的查询

## 二、MySQL查询优化程序
略
